/**
 * Useful Sass Mixins
 * -----------------------------------------------------------------------------
 * @category   Stylesheet
 * @package    Scss Helpers
 * @author     Mark Grealish <mark@bhalash.com>
 * @copyright  Copyright (c) 2015, Mark Grealish
 * @license    http://opensource.org/licenses/MIT The MIT License (MIT)
 * @version    2.0
 * @link       https://github.com/bhalash/scss-helpers
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */

/**
 * Set Position of Fixed, Absolute or Relative Items
 * -----------------------------------------------------------------------------
 */

@mixin position($position, $units) {
    $properties: top right bottom left;
    
    position: $position;

    @each $offset in $properties  {
        $index: index($args, $offset);

        @if $index {
            @if $index == length($args) {
                #{$offset}: 0;
            } @else {
                $next: nth($args, $index + 1);

                @if is-valid-length($next) {
                    #{$offset}: $next;
                } @else if index($offsets, $next) {
                    #{$offset}: 0;
                } @else {
                    @warn "Invalid value `#{$next}` for offset `#{$offset}`.";
                }
            }
        }
    }
}

@mixin absolute(absolute, $args) {
    position: absolute;
}

@mixin fixed(fixed, $args) {
    position: absolute;
}

@mixin relative(relative, $args) {
    position: absolute;
}

/**
 * Validate Unit
 * -----------------------------------------------------------------------------
 * Validate that a given length is a valid unit.
 * See: http://hugogiraudel.com/2014/05/19/new-offsets-sass-mixin/
 * 
 * @param   string     $value    The candidate value. Can be number or keyword.
 * @return  bool                 Unit is valid true or false.
 */

@function valid-unit($value) {
  @return (type-of($value) == "number" and not unitless($value)) or (index(auto initial inherit 0, $value) != false);
}

/**
 * Fetch from Color Palette
 * -----------------------------------------------------------------------------
 * See: http://erskinedesign.com/blog/friendlier-color-names-sass-maps/
 * 
 * In short, the post advocates a mapped palette of colors and tones using a 
 * set schema, and then using this function to return the colors. 
 *
 *      $_color-base-gray: rgb(229,231,234);
 * 
 *      $palettes: (
 *          purple: (
 *              base: rgb(42,40,80),
 *              light: rgb(51,46,140),
 *              dark: rgb(40,38,65)
 *             ),
 *          gray: (
 *              base: $_color-base-gray,
 *              light: lighten($_color-base-gray, 10%),
 *              dark: darken($_color-base-gray, 10%)
 *          )
 *      );
 *
 */

@function palette($color, $tone: 'base', $palette: $default-colors) {
    @return map-get(map-get($palette, $color), $tone);
}

/**
 * Vendor Property and Value Prefixes
 * -----------------------------------------------------------------------------
 * Automatically vendor prefixes to CSS properties and values.
 * For the most part I only need to prefix for webkit, so that is the default
 * set.
 */

@mixin prefix($property, $value, $prefixes: webkit) {
    @each $prefix in $prefixes {
        #{'-' + $prefix + '-' + $property}: $value;
    }

    #{$property}: #{$value};
}

@mixin prefix-value($property, $value, $prefixes: webkit) {
    @each $prefix in $prefixes {
        #{$property}: #{'-' + $prefix + '-' + $value};
    }

    #{$property}: #{$value};
}

/**
 * Decimal Unit to rem
 * -----------------------------------------------------------------------------
 * See: http://snook.ca/archives/html_and_css/font-size-with-rem 
 * 
 * @param   string  $unit               Input decimal unit (0.3, 1.7, etc);
 * @param   float   $rem-multiplier     The multiplier value for the unit
 * @return  int                         The given unit as an rem value.
 */

@function rem($unit, $rem-multiplier: $default-rem-multiplier) {
    @return #{$unit * $rem-multiplier}rem;
}

/**
 * Decimal Unit to px
 * -----------------------------------------------------------------------------
 * @param   string  $unit               Input decimal unit (0.3, 1.7, etc);
 * @param   float   $rem-multiplier     The multiplier value for the unit
 * @return  int                         The given unit as a px value.
 */

@function pixel($unit, $px-multiplier: $default-px-multiplier) {
    @return #{$unit * $px-multiplier}px;
}

/**
 * Convert Decimal Unit to Given Output Unit
 * -----------------------------------------------------------------------------
 * Take in a given decimal multiplier (1.2, 2.3, etc) and return it in the given
 * output unit. Currently I support:
 * 
 * rem
 * px
 */

@function convert-decimal-unit($units, $type: null) {
    $return-units: '';
    $i: 1;

    @each $unit in $units {

        $return-units: $return-units + #{$type}($unit);

        @if ($i < length($units)) {
            $return-units: $return-units + ' ';
            $i: $i + 1;
        }
    }

    @return $return-units;
}

/**
 * rem Mixins 
 * -----------------------------------------------------------------------------
 */

@mixin rem-value($property, $unit) {
    #{$property}: pixel($unit);
    #{$property}: rem($unit);
}

@mixin font-size($size: 1) {
    // font-size in rem with px fallback.
    @include rem-value(font-size, $size);
}

@mixin line-height($size: 1) {
    // line-height in rem with px fallback.
    @include rem-value(line-height, $size);
}

/**
 * Decimal Margin and Padding
 * -----------------------------------------------------------------------------
 * These two don't do too much except make life easier: Set margin or padding as
 * a multiplier of the base margin and padding. The side can be appended through
 * an optional operator. If you do set a side, every margin or padding except 
 * the first passed will be silently discarded.
 */

@mixin margin($margin, $side: null) {
    @if ($side) {
        $margin: nth($margin, 1);
    }

    margin#{-$side}: convert-decimal-unit($margin, px);
    margin#{-$side}: convert-decimal-unit($margin, rem);
}

@mixin padding($padding, $side: null) {
    @if ($side) {
        $padding: nth($padding, 1);
    }

    padding#{-$side}: convert-decimal-unit($padding, px);
    padding#{-$side}: convert-decimal-unit($padding, rem);
}

/**
 * Social Images and Colours
 * -----------------------------------------------------------------------------
 * I wanted to reduce the work (and load time) of ubiqui-cancerous social 
 * icons. So:
 * 
 * 1. This uses a SVG spritesheet and is tuned to interact with it.
 * 2. If you ever alter the spritesheet then you will also need to alter
 *    the given background-positon rules in the array.
 * 2. Size can be arbitrary and defaults to:
 *          a. Width equal to 100% of parent width.
 *          b. Height equal to 100% of parent height.
 * 3. Any given pixel size is treated identically-square.
 * 4. If you need finer control anyhing, add it as content.
 * 
 * You can find the connected SVG spritesheet on GitHub at he following
 * URL: https://gist.github.com/bhalash/6bad337ac7445054d3a9#file-gistfile2-svg
 * 
 * Feel free to create and use your own spritesheet using the map below as a 
 * template! :)
 */

@mixin generate-social-link($element, $size: $default-button-size, $service: null, $spritesheet: $default-spritesheet) {
    /* Element can be a class, ID, element-whatever. #foo, .a or baz, or a[href^=fizz]
     * are all perfectly acceptable. */

    // Path to sprtesheet.
    $url: nth(map-get($spritesheet, sprites), 1);
    // Columns/width.
    $columns: nth(map-get($spritesheet, sprites), 2);
    // Rows/height.
    $rows: nth(map-get($spritesheet, sprites), 3);
    // Positional information.
    $networks: map-get($spritesheet, positions);
    // Pixel/percentage/rem/em/whatever size.
    $width: nth($size, 1);
    // Ratio of height to width. See square-flex().
    $ratio: nth($size, 2);

    #{$element} {
        // Vector spritesheet is background-image.
        background-image: url($url);
        /* Final icon is square. background-image size is:
         * width: icon size * number of rows in spritesheet
         * height: icon size * number of columns in spritesheet */
        background-size: #{$width * $columns} #{$width * $rows};
        background-repeat: no-repeat;
        display: block;
        @include square-flex($width $ratio);
        @content;
    }

    @if ($service) {
        // If you supply a service, just output link for that.
        $color: nth(map-get($networks, $service), 1);
        $position-x: nth(map-get($networks, $service), 2);
        $position-y: nth(map-get($networks, $service), 3);

        #{$element}.#{$service} {
            background-color: $color;
            background-position: $position-x $position-y;
        }
    } @else {
        // Else iterate map-list to produce social links.
        @each $map, $network in $networks {
            $color: nth($network, 1);
            $position-x: nth($network, 2);
            $position-y: nth($network, 3);

            #{$element}.#{$map} {
                background-color: $color;
                background-position:  $position-x $position-y;
            }
        }
    }
}

/**
 * Flexbox
 * -----------------------------------------------------------------------------
 * See https://css-tricks.com/snippets/css/a-guide-to-flexbox/ for a primer on
 * CSS flexbox. If you have come this far you should have an understanding of
 * how, why and where you would use flexbox.
 * 
 * These two mixins generate rules for parent and child elements respectively.
 * By default, the parent will be a row and the child will have a flex value of 
 * 1.
 * 
 * As of April 2015 cross-browser support for flexbox isn't complete; there are
 * major issues with vertical alignment in Internet Explorer and all versions
 * of Safari (desktop and mobile) require properfies and values to be prefixed
 * with -webkit-foo.
 */

@mixin flex-parent($direction: row, $justify-content: null, $wrap: null, $align-items: null) {
    // Generate flex parent rules.
    @include prefix-value(display, flex, webkit);
    @include prefix(flex-direction, $direction, webkit);

    @if ($justify-content) {
        @include prefix(justify-content, $justify-content, webkit);
    }

    @if ($wrap) {
        @include prefix(flex-wrap, $wrap, webkit);
    }

    @if ($align-items) {
        @include prefix(align-items, $align-items, webkit);
    }
}

@mixin flex-child($flex: 1, $align-self: null, $order: null) {
    // Generate flex children rules.
    @include prefix(flex, $flex, webkit);

    @if ($align-self) {
        @include prefix(align-self, $align-self, webkit);
    }

    @if ($order) {
        @include prefix(order, $order, webkit);
    }
}

/**
 * Flexible Square Boxes
 * -----------------------------------------------------------------------------
 * Generate a box whose height is equal to the given ratio of the width.
 * Width can be of any size.
 * Ratio should be between 0 and foo.
 * 
 * See: http://stackoverflow.com/a/13625843/1433400
 * See: http://alistapart.com/article/creating-intrinsic-ratios-for-video
 */

@mixin square-flex($flex-size: 100% 1) {
    $width: nth($flex-size, 1);
    $ratio: nth($flex-size, 2);

    height: 0;
    padding-bottom: $width * $ratio;
    width: $width;
}
 
/**
 * Miscellaneous Mixins and Functions
 * -----------------------------------------------------------------------------
 */

@mixin vertical-center($amount) {
    // Useful for vertically centering elements.
    padding-bottom: $amount;
    padding-top: $amount;
}

@function rgba-opposite($red: 255, $green: 255, $blue: 255, $alpha: 0) {
    $red: 255 - $red;
    $green: 255 - $green;
    $blue: 255 - $blue;
    $alpha: 1 - $alpha;

    @return rgba($red, $green, $blue, $alpha);
}

@mixin columns($count, $gap) {
    @include prefix(column-count, $count);
    @include prefix(column-gap, $gap);
}

/**
 * Placeholder Styles
 * -----------------------------------------------------------------------------
 * Generate styles for input placeholders in Internet Explorer, Firefox and 
 * Webkit browsers. Use as follows:
 * 
 *      input {
 *          @include placeholder-style() {
 *              foo: bar;
 *          }
 *      }
 */

@mixin placeholder-style() {
    &::-webkit-input-placeholder {
       @content;
    }

    &::-webkit-input-placeholder {
        @content;
    }

    &:-moz-placeholder {
        @content;
        opacity: 1;
    }

    &::-moz-placeholder {
        @content;
        opacity: 1;
    }

    &:-ms-input-placeholder {
        @content;
    }
}

/**
 * Background Coloured Mask
 * -----------------------------------------------------------------------------
 * Useful for when you have to layer text above a background image.
 */

@mixin mask($red: 255, $green: 255, $blue: 255, $opacity: 1) {
    background-color: rgba($red, $green, $blue, $opacity);
}

/**
 * @font-face Declaration
 * -----------------------------------------------------------------------------
 * There are a bunch of Sass/Scss @font-face mixins available on the Internet, 
 * but each of them is fundamentally inflexible. They variously:
 * 
 * 1. Require a fixed file path.
 * 2. Fixed existence of files, by which I mean each and every possible type of 
 *    file (eot, woff, etc).
 * 3. Fixed order of declaration.
 * 
 * With font-face, I hopefully have provided something a little bit more 
 * flexible: declare all of the attributes of your @font-face in a map, and then
 * call the font-face mixin.
 * 
 * Weight, stretch and style are all optional.
 *
 * Example map:
 *
 *      $open-sans: (
 *          family: 'font-name',
 *          folder: '/path/to/folder/',
 *          filename: 'FontName',
 *          types: ('ttf', 'woff', 'eot'),
 *          weight: 'normal',
 *          style: 'normal',
 *          stretch: 'condensed'
 *      );
 *
 * Then call with: 
 * 
 *      @include font-face($open-sans);
 */

@mixin font-face($font) { 
    $family: map-get($font, family);
    $folder: map-get($font, folder);
    $filename: map-get($font, filename);
    $types: map-get($font, types);
    $src: ();

    @font-face {
        font-family: $family;

        @each $type in $types {
            // Iterate to produce the path and type, and then set it.
            $path: $folder + $filename + '.' + $type; 
            $src: $append($src, 'url(' + $path + ') format("' + $type + '")');
        }

        src: #{$src};

        // Optionally override CSS text defaults:

        @if (map-has-key($font, weight)) {
            font-weight: map-get($font, weight);    
        }

        @if (map-has-key($font, style)) {
            font-style: map-get($font, style);
        }

        @if (map-has-key($font, stretch)) {
            // Not supported anywhere. Ware ye.
            font-stretch: map-get($font, stretch);
        }

        @content;
    } 
}